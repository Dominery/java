# 函数式编程

对大多数程序员而言，最关心的日常要务是代码维护时的调试：代码遭遇一些无法预期的值就有可能发生崩溃。这种无法预知的变量修改问题，都源于共享的数据结构被代码中的多个方法读取和更新。函数式编程提出的“无副作用”以及“不变性”有利于解决这一难题。

## 函数式编程的特性

函数式编程具体实践了声明式编程（“你只需要使用不相互影响的表达式，描述想要做什么，由系统来选择如何实现”）和无副作用计算。这两个思想更容易地构建和维护系统。

### 副作用

如果一个方法既不修改它内嵌类的状态，也不修改其他对象的状态，使用return返回所有的计算结果，那么我们称其为纯粹的或者无副作用的。

> 副作用就是函数的效果已经超出了函数自身的范畴。

#### 造成副作用的因素

1. 除了构造器内的初始化操作，对类中数据结构的任何修改，包括字段的赋值操作（一个典型的例子是setter方法）。
2. 抛出一个异常。
3. 进行输入/输出操作，比如向一个文件写数据。

#### 实现无副作用的方式

1. 不可变对象

   不可变对象是实现无副作用的一种方式，它们一旦完成初始化就不会被任何方法修改状态。这意味着一旦一个不可变对象初始化完毕，它永远不会进入到一个无法预期的状态。你可以放心地共享它，无需保留任何副本，并且由于它们不会被修改，还是线程安全的。

2. 递归

   纯粹的函数式编程语言通常不包含像while或者for这样的迭代构造器。这种类型的构造器经常会改变对象状态。比如，while循环中，循环的条件需要更新；否则循环就一次都不会执行，要么就进入无限循环的状态。通过无需修改的递归重写方法避免使用迭代。

   递归开销比迭代大

   > 每次执行factorialRecursive方法调用都会在调用栈上创建一个新的栈帧，用于保存每个方法调用的状态，这意味着递归迭代方法会依据它接收的输入成比例地消耗内存。

   函数式语言提供了一种方法解决这一问题：尾调优化（tail-calloptimization）。

### 声明式编程

一般通过编程实现一个系统，有两种思考方式。一种专注于如何实现，另一种方式则更加关注要做什么。

> “如何做”风格的编程非常适合经典的面向对象编程，有些时候我们也称之为“命令式”编程，因为它的特点是它的指令和计算机底层的词汇非常相近，比如赋值、条件分支以及循环。
>
> “要做什么”风格的编程通常被称为声明式编程。你制定规则，给出了希望实现的目标，让系统来决定如何实现这个目标。用这种方式编写的代码更加接近问题陈述。

## 函数式编程思想

函数式编程是一种使用函数进行编程的方式。

> 在函数式编程的上下文中，一个“函数”对应于一个数学函数：它接受零个或多个参数，生成一个或多个结果，并且不会有任何副作用。

### 函数式编程准则

1. 被称为“函数式”的函数或方法都只能修改本地变量。

2. 它引用的对象都应该是不可修改的对象。通过这种规定，我们期望所有的字段都为final类型，所有的引用类型字段都指向不可变对象。

3. 函数或者方法不应该抛出任何异常

   > 为实现不使用异常的目的，可以使用Optional返回调用结果

4. 你的函数或方法调用的库函数如果有副作用，你必须设法隐藏它们的非函数式行为

### 函数式java编程

编程实战中，无法用Java语言以纯粹的函数式来完成一个程序的。比如，Java的I/O模型就包含了带副作用的方法。

在Java语言中，如果希望编写函数式的程序，首先需要做的是确保没有人能觉察到代码的副作用，这也是函数式的含义。

* 引用透明性

  如果一个函数只要传递同样的参数值，总是返回同样的结果，那这个函数就是引用透明的。

  > “没有可感知的副作用”（不改变对调用者可见的变量、不进行I/O、不抛出异常）的这些限制都隐含着引用透明性。

* 注意点

  考虑编程问题时，采用函数式的方法，关注函数的输入参数以及输出结果（即你希望做什么），通常比设计阶段的早期就考虑如何做、修改哪些东西要卓有成效得多。